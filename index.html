<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Web ERG Trainer</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.cyan.min.css"
    />
    <link rel="stylesheet" href="./main.css" />
  </head>
  <body>
    <main class="container" x-data="workoutApp()">
      <form @submit.prevent="startWorkout" x-data x-show="showForm">
        <fieldset>
          <label
            >Vélo
            <input
              type="button"
              @click="connectErgo"
              :disabled="ergometerName"
              x-bind:value="ergometerName || 'Connecter'"
            />
          </label>
          <label
            >Cardio
            <input
              type="button"
              @click="connectHeartRateMonitor"
              :disabled="heartRateMonitorName"
              x-bind:value="heartRateMonitorLabel"
            />
          </label>
          <label
            >FTP (watts)
            <input
              type="number"
              min="50"
              max="500"
              step="5"
              x-model="ftp"
              placeholder="150"
            />
            <small>
              Functional Threshold Power - utilisé pour calculer les intensités
              de l'entraînement
            </small>
          </label>
          <label
            >Poids (kg)
            <input
              type="number"
              min="40"
              max="150"
              step="1"
              x-model="weight"
              placeholder="70"
            />
            <small>
              Poids du cycliste - utilisé pour calculer la vitesse virtuelle
            </small>
          </label>
          <label
            >Entraînement
            <input
              required
              type="file"
              accept=".zwo,.xml"
              @change="onZwoFileChange"
            />
            <small
              >Fichier d'entraînement au format ZWO
              <a class="secondary" href="#" onclick="zwoModal.showModal()"
                >ⓘ En savoir plus</a
              ></small
            >
          </label>

          <dialog
            id="noBluetoothModal"
            x-init="if (!navigator.bluetooth) noBluetoothModal.showModal()"
          >
            <article>
              <header>
                <h3>Bluetooth non supporté</h3>
              </header>
              <p>
                Ton navigateur ne supporte pas les connexions Bluetooth. Tu peux
                essayer
                <a href="https://caniuse.com/?search=bluetooth">
                  avec un autre navigateur</a
                >.
              </p>
              <footer>
                <button onclick="noBluetoothModal.close()">Fermer</button>
              </footer>
            </article>
          </dialog>

          <dialog id="zwoModal">
            <article>
              <header>
                <h3>Qu'est-ce qu'un fichier ZWO ?</h3>
              </header>
              <p>
                Un fichier <strong>ZWO</strong> est un format XML utilisé pour
                décrire des entraînements structurés pour le cyclisme, notamment
                sur Zwift et d'autres plateformes d'entraînement. Il contient la
                séquence des intervalles, leur durée et leur intensité.
              </p>
              <ul>
                <li>
                  Tu peux en trouver sur
                  <a href="https://whatsonzwift.com/workouts/" target="_blank"
                    >whatsonzwift.com</a
                  >
                  ou
                  <a href="https://zwofactory.com/" target="_blank"
                    >zwofactory.com</a
                  >.
                </li>
                <li>
                  Tu peux aussi créer les tiens avec des éditeurs en ligne.
                </li>
              </ul>
              <footer>
                <button onclick="zwoModal.close()">Fermer</button>
              </footer>
            </article>
          </dialog>
          <button type="submit">Démarrer</button>
        </fieldset>
      </form>
      <div x-show="showWorkout">
        <hgroup>
          <h2>
            <span x-text="workoutMeta?.name"></span> -
            <span x-text="workoutMeta?.totalDuration"></span> minutes
          </h2>
          <p
            x-data="{clamp: 3}"
            class="workout-description"
            @click="clamp = clamp === 3 ? 100 : 3"
            x-bind:style="`-webkit-line-clamp: ${clamp}`"
          >
            <span x-text="workoutMeta?.description"></span>
            <cite x-text="` — ${workoutMeta?.author}`"></cite>
          </p>
        </hgroup>

        <article x-show="isPaused" class="grid">
          <h4>Entrainement en pause</h4>
          <button class="outline" @click="stopWorkout">Arrêter</button>
        </article>

        <article x-show="workoutFinished" class="grid">
          <h4>Entrainement terminé</h4>
          <button @click="exportTcx">Exporter TCX</button>
        </article>

        <table>
          <thead>
            <tr>
              <th>Temps</th>
              <th>Puissance</th>
              <th>Cadence</th>
              <th>Cardio</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td x-text="timer">0:00</td>
              <td><span x-text="power">-</span> W</td>
              <td><span x-text="cadence">-</span> rpm</td>
              <td><span x-text="heartRate">-</span> bpm</td>
            </tr>
          </tbody>
        </table>
        <div class="phase-progress-container">
          <span x-text="phaseTimeRemaining">0:00</span>
          <progress x-bind:value="phaseProgress" max="100"></progress>
        </div>

        <div x-ref="workoutSvg" class="workout-svg-container"></div>
      </div>
    </main>
    <script type="module" src="js/main.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </body>
</html>
